Code borrowed from Apache Beam project.